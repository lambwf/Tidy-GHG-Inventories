"0",""
"0","files_crts = files_crts %>% filter(file_year==max(files_crts$file_year))"
"0",""
"0","## get the total GHG emissions from each CRT"
"0",""
"0","data_crts_totals <- data.frame()"
"0",""
"0","for (i in 1:length(files_crts$country)) {"
"0","  "
"0","  totals <- read.xlsx(xlsxFile = paste0(""sources/CRTs/"",files_crts$dir[i],""/"",files_crts$files[i]),"
"0","                       sheet = paste0(""Table10s1""),"
"0","                       startRow = 8) %>%"
"0","    select(var=""GREENHOUSE.GAS.SOURCE.AND.SINK.CATEGORIES"",matches(""^\\d{4}"")) %>% "
"0","    rename_with(~ substr(., 1, 4), matches(""^\\d{4}"")) %>% "
"0","    mutate(units = ""ktCO2e"") %>% "
"0","    mutate(gas = ""ghg"")"
"0","  "
"0","  "
"0","  totals <- totals %>% "
"0","    filter(grepl(""Total"",var)) %>% "
"0","    filter(grepl(""net emissions"",var)) %>% "
"0","    gather(.,year,total,-var,-units,-gas) %>% "
"0","    mutate(iso=files_crts$iso[i]) %>%"
"0","    mutate(year=as.numeric(year)) %>% "
"0","    mutate(total=as.numeric(total)*1000) %>% "
"0","    select(iso,year,total)"
"0","  "
"0","  data_crts_totals <- bind_rows(data_crts_totals,totals)"
"0","    "
"0","  "
"0","}"
"2","Warnung: [38;5;232mThere was 1 warning in `mutate()`.[39m
[38;5;232m[36mâ„¹[38;5;232m In argument: `total = as.numeric(total) * 1000`.[39m
Caused by warning:
[33m![39m NAs durch Umwandlung erzeugt"
"2","Warnung: [38;5;232mThere was 1 warning in `mutate()`.[39m
[38;5;232m[36mâ„¹[38;5;232m In argument: `total = as.numeric(total) * 1000`.[39m
Caused by warning:
[33m![39m NAs durch Umwandlung erzeugt"
"0","  "
"0",""
"0","# do my leaf node emissions sum up to totals in the CRT summaries?"
"0",""
"0","check <- data_crts %>% "
"0","  group_by(iso,year) %>% "
"0","  summarise(value=sum(value,na.rm=TRUE))"
"2","`summarise()` has grouped output by 'iso'. You can override using the `.groups` argument."
"0","check <- left_join(check,data_crts_totals,by=join_by(iso,year))"
"0",""
"0","check <- check %>% "
"0","  mutate(difference_abs=value-total) %>% "
"0","  mutate(difference_rel=(difference_abs/value)*100) %>% "
"0","  filter(abs(difference_rel)>0.01)"
"0","  "
"0","# check_gha <- data_crts %>% "
"0","#   filter(iso==""GHA"") %>% "
"0","#   filter(year==2022) %>% "
"0","#   group_by(iso,year,sector_lv1) %>% "
"0","#   summarise(value=sum(value,na.rm=T))"
"0",""
"0",""
"0",""
