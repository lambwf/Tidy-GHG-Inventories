"0",""
"0",""
"0",""
"0","## Get map data and clean up iso codes"
"0",""
"0","map <- map_data(""world"") %>% filter(region!=""Antarctica"")"
"0","map <- map %>% "
"0","  left_join(.,map %>% "
"0","              select(region) %>% "
"0","              distinct() %>% "
"0","              mutate(iso=countrycode(region,""country.name"",""iso3c"")),"
"0","            by=join_by(region))"
"0",""
"0",""
"0","## Get a list of countries that have complete inventories"
"0",""
"0","country_list <- data_crts %>% "
"0","  group_by(iso,country,year) %>% "
"0","  summarise(value=sum(value,na.rm=T)) %>% "
"0","  group_by(iso,country) %>% "
"0","  mutate(n=n())"
"0",""
"0","country_list <- country_list %>% "
"0","  ungroup() %>% "
"0","  mutate(coverage=ifelse(n>=33,""Submitted,\ndata from 1990-2022"",""Submitted,\npartial data up to 2022"")) %>% "
"0","  select(iso,country,n,coverage) %>% "
"0","  distinct()"
"0",""
"0",""
"0","## Join to map data"
"0",""
"0","map <- map %>% left_join(.,country_list,by=join_by(iso))"
"0","map <- map %>% mutate(coverage=ifelse(is.na(coverage),""Not submitted or\nnon-standard format"",coverage))"
"0",""
"0",""
"0","## Fix greenland"
"0","map <- map %>% mutate(coverage=ifelse(region==""Greenland"",""Submitted,\ndata from 1990-2022"",coverage))"
"0",""
"0",""
"0","## Arrange factors, get date"
"0",""
"0","map$coverage <- as.factor(map$coverage)"
"0","map$coverage <- fct_relevel(map$coverage,""Submitted,\ndata from 1990-2022"",""Submitted,\npartial data up to 2022"",""Not submitted / non-standard format"")"
"0",""
"0","Sys.setlocale(""LC_TIME"", ""en_US.UTF-8"")"
"1","[1]"
"1"," ""en_US.UTF-8"""
"1","
"
"0","current_date <- paste0(""Submissions up to "",format(Sys.Date(), ""%B %d, %Y""))"
"0","current_date <- str_wrap(current_date,width=20)"
"0",""
"0","## Plot"
"0",""
"0","p <- ggplot() + "
"0","  geom_polygon(data = map, aes(x=long, y = lat, group=group, fill=coverage),color=""#636363"",size=0.2,na.rm=T) + "
"0","  #coord_fixed(1,xlim=c(-120,70),ylim=c(0,70)) +"
"0","  scale_fill_manual(values= c(""Submitted,\ndata from 1990-2022""=""#7dd396ff"","
"0","                              ""Submitted,\npartial data up to 2022""=""#659cccff"","
"0","                              ""Not submitted or\nnon-standard format""='#818181ff')) +"
"0","  theme_wl_empty() +"
"0","  theme(legend.position = c(0.14, 0.2),"
"0","        panel.border = element_rect(colour = ""#636363"",fill=NA),"
"0","        legend.title=element_text(size=10),"
"0","        legend.text=element_text(size=8)) +"
"0","  labs(subtitle = paste0(""GHG inventory submissions under the latest Biennial Transparency Reports""),"
"0","       caption = ""⌂ Data: UNFCCC, Tidy GHG inventories   ⌂ CC-BY William F. Lamb \n"","
"0","       fill=current_date)"
"0","p  "
