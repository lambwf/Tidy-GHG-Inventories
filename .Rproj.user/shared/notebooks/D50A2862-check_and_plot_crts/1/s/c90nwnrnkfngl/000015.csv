"0",""
"0","load(""sources/data_crt_files.RData"")"
"0",""
"0","files <- data_crts %>% "
"0","  select(iso,country,dir) %>% "
"0","  distinct() %>% "
"0","  mutate(keep=1)"
"0",""
"0","files_crts <- files_crts %>% "
"0","  left_join(.,files,by = join_by(dir, country, iso)) %>% "
"0","  filter(keep==1)"
"0",""
"0",""
"0",""
"0","files_crts <- files_crts %>%"
"0","  arrange(iso,year_file) %>% "
"0","  group_by(iso,dir) %>% "
"0","  mutate(include=ifelse(year_file==last(year_file),1,0)) %>% "
"0","  filter(include==1)"
"0",""
"0",""
"0",""
"0","## get the total GHG emissions from each CRT"
"0",""
"0","data_crts_totals <- data.frame()"
"0",""
"0","for (i in 1:length(files_crts$country)) {"
"0","  "
"0","  totals <- read.xlsx(xlsxFile = paste0(""sources/done/"",files_crts$dir[i],""/"",files_crts$files[i]),"
"0","                       sheet = paste0(""Table10s1""),"
"0","                       startRow = 8) %>%"
"0","    select(var=""GREENHOUSE.GAS.SOURCE.AND.SINK.CATEGORIES"",matches(""^\\d{4}"")) %>% "
"0","    rename_with(~ substr(., 1, 4), matches(""^\\d{4}"")) %>% "
"0","    mutate(units = ""ktCO2e"") %>% "
"0","    mutate(gas = ""ghg"")"
"0","  "
"0","  "
"0","  totals <- totals %>% "
"0","    filter(grepl(""Total"",var)) %>% "
"0","    filter(grepl(""net emissions"",var)) %>% "
"0","    gather(.,year,total,-var,-units,-gas) %>% "
"0","    mutate(iso=files_crts$iso[i]) %>%"
"0","    mutate(year=as.numeric(year)) %>% "
"0","    mutate(total=as.numeric(total)*1000) %>% "
"0","    select(iso,year,total)"
"0","  "
"0","  data_crts_totals <- bind_rows(data_crts_totals,totals)"
"0","    "
"0","  "
"0","}"
"0","  "
"0",""
"0","# do my leaf node emissions sum up to totals in the CRT summaries?"
"0",""
"0","check <- data_crts %>% "
"0","  group_by(iso,country,year) %>% "
"0","  summarise(value=sum(value,na.rm=TRUE))"
"0",""
"0","check <- left_join(check,data_crts_totals,by=join_by(iso,year))"
"0",""
"0","check <- check %>% "
"0","  mutate(difference_abs=value-total) %>% "
"0","  mutate(difference_rel=(difference_abs/value)*100) %>% "
"0","  filter(abs(difference_rel)>0.01)"
"0","  "
"0",""
"0",""
"0","blarg <- data_crts %>% "
"0","  filter(iso==""EU27"" & year==2023) %>% "
"0","  group_by(year,sector_lv1) %>% "
"0","  summarise(value=sum(value,na.rm=T)/1000)"
"0",""
"0",""
"0",""
