"0",""
"0",""
"0","#data_decomp <- data.frame(iso=""AUS"",year=c(1990,2022),sector_lv4=c(""a"",""a"",""b"",""b""),e_ghg=c(30,80,20,16),activity=c(10,80,20,16),activity_share=c(0.2,0.5,0.8,0.5),ef_ghg=c(3,2,0.5,0.4))"
"0",""
"0","# data_decomp <- data_decomp %>%"
"0","#   filter(year %in% c(1990,2022)) %>%"
"0","#   filter(iso==""AUS"") %>%"
"0","#   filter(sector_lv3 %in% c(""Energy industries"",""Transport"")) %>%"
"0","#   group_by(iso,year,sector_lv3) %>%"
"0","#   summarise_at(vars(activity,e_ghg),sum,na.rm=T) %>%"
"0","#   rename(sector_lv4=sector_lv3)"
"0","# "
"0","# data_decomp <- data_decomp %>%"
"0","#   group_by(iso,year) %>%"
"0","#   mutate(activity_total=sum(activity)) %>%"
"0","#   ungroup() %>%"
"0","#   mutate(activity_share=activity/activity_total) %>%"
"0","#   mutate(ef_ghg=e_ghg/activity)"
"0","# "
"0",""
"0",""
"0","# select time steps"
"0","data_decomp <- data_decomp %>%"
"0","  filter(year %in% c(2000,2022))"
"0",""
"0","# calculate logarithmic mean of the emissions change per sector"
"0","data_decomp <- data_decomp %>%"
"0","  group_by(iso,sector_lv4) %>% "
"0","  mutate(w=(last(e_ghg)-first(e_ghg))/(log(last(e_ghg))-log(first(e_ghg))))"
"0",""
"0","# calculate activity effect"
"0","data_decomp <- data_decomp %>%"
"0","  mutate(aw=log(last(activity_total)/first(activity_total))) %>% "
"0","  mutate(Q=w*aw) "
"0",""
"0","# calculate structure and intensity effects"
"0","data_decomp <- data_decomp %>% "
"0","  group_by(iso,sector_lv4) %>% "
"0","  mutate(S=w*(log(last(activity_share)/first(activity_share)))) %>% "
"0","  mutate(I=w*(log(last(ef_ghg)/first(ef_ghg)))) %>% "
"0","  mutate(E=last(e_ghg)-first(e_ghg))"
"0",""
"0",""
"0","## check sums"
"0","data_decomp <- data_decomp %>%"
"0","  ungroup() %>% "
"0","  mutate(test=Q+S+I)"
"0",""
"0","blarg <- data_decomp %>% "
"0","  filter(year==2022) %>% "
"0","  group_by(iso) %>% "
"0","  summarise_at(vars(Q,S,I,E),sum)"
"0",""
