"0",""
"0","## join AR5 GWPs"
"0","gwps <- read.csv(""https://raw.githubusercontent.com/openclimatedata/globalwarmingpotentials/main/globalwarmingpotentials.csv"",skip = 10) %>% select(gas=Species,gwp100_ar5=AR5GWP100) %>% mutate(gas=tolower(gas))"
"0",""
"0","data_crts <- data_crts %>% "
"0","  left_join(.,gwps,by=""gas"")"
"0",""
"0","data_crts <- data_crts %>% "
"0","  mutate(gwp100_ar5=ifelse(!gas %in% c(""ch4"",""n2o""),1,gwp100_ar5)) %>% "
"0","  mutate(value_gwp100=value*gwp100_ar5)"
"0",""
"0",""
"0","## check units are in kt and convert to t"
"0",""
"0","data_crts <- data_crts %>% "
"0","  {if (any(!str_starts(.$units, ""kt""))) stop(""Error: Not all values in the 'units' column start with 'kt'"")"
"0","    else ."
"0","  } %>%"
"0","  mutate(value_gwp100 = value_gwp100 * 1000)"
"0",""
"0","data_crts <- data_crts %>% "
"0","  mutate(units=""tCO2e (GWP100 AR5)"") %>% "
"0","  select(-gwp100_ar5,-value) %>% "
"0","  rename(value=value_gwp100)"
"0",""
"0",""
"0","## set levels and arrange"
"0","data_crts$gas <- as.factor(data_crts$gas)"
"0","data_crts$gas <- factor(data_crts$gas,levels=c(""co2"",""ch4"",""n2o"",""hfcs"",""pfcs"",""nf3"",""sf6"",""hfcs/pfcs (unspecified)""))"
"0",""
"0",""
"0","## tidy up file"
"0","data_crts <- data_crts %>% "
"0","  filter(!is.na(sector_lv1)) %>% "
"0","  select(country,iso,sector_code,sector_level,sector_lv1,sector_lv2,sector_lv3,gas,units,year,value)"
"0",""
"0","data_crts <- data_crts %>% arrange(across(-ncol(data_crts)))"
"0",""
"0",""
