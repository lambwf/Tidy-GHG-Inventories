"0",""
"0","############ wide version"
"0",""
"0","wb_wide <- createWorkbook()"
"0","addWorksheet(wb_wide,""info"")"
"0","addWorksheet(wb_wide,""data"")"
"0","addWorksheet(wb_wide,""memos"")"
"0","addWorksheet(wb_wide,""countries"")"
"0",""
"0","data_crts_wide <- data.frame()"
"0",""
"0","for (i in 1:length(files_crts$iso)) {"
"0","  "
"0","  temp <- left_join(sector_summary,data_crts %>% "
"0","                     filter(iso==files_crts$iso[i]) %>% "
"0","                     spread(.,year,value),"
"0","                    by = join_by(sector_code, sector_level, sector_lv1, sector_lv2, sector_lv3))"
"0","  "
"0","  if (all(is.na(temp$iso))) {"
"0","    "
"0","  }"
"0","  else {"
"0","  "
"0","    temp <- temp %>% "
"0","      mutate(iso=na.locf(iso,fromLast=T)) %>% "
"0","      mutate(country=na.locf(country,fromLast=T))"
"0","  "
"0","    data_crts_wide <- bind_rows(temp,data_crts_wide)"
"0","    "
"0","  }"
"0","  "
"0","}"
"0",""
"0","data_crts_wide <- data_crts_wide %>% "
"0","  mutate(sector_code=as.factor(sector_code)) %>% "
"0","  mutate(sector_code=fct_inorder(sector_code)) %>%"
"0","  select(-is_leaf,-`included in data tab?`) %>%"
"0","  select(country,iso,everything()) %>% "
"0","  select(country:units,"
"0","         sort(select(., starts_with(""20"") | starts_with(""19"")) %>% names())) %>% "
"0","  arrange(country,iso,sector_code)"
"0",""
"0",""
"0","writeData(wb_wide, sheet = ""info"", info, colNames = F, rowNames = F)"
"0","writeData(wb_wide, sheet = ""data"", data_crts_wide, colNames = T, rowNames = F)"
"0","writeData(wb_wide, sheet = ""memos"", data_memos %>% spread(.,year,value), colNames = T, rowNames = F)"
"0","writeData(wb_wide, sheet = ""countries"", country_summary, colNames = T, rowNames = F)"
"0",""
"0","textStyle <- createStyle(fontSize = 11, wrapText = TRUE, valign = ""top"", halign = ""left"")"
"0","addStyle(wb_wide, ""info"", textStyle, rows = 1:nrow(info), cols = 1:2, gridExpand = TRUE)"
"0","addStyle(wb_wide, ""data"",createStyle(numFmt= ""0""),rows=1:nrow(data_crts),cols=which(names(data_crts)==""year""))"
"0","addStyle(wb_wide, ""memos"",createStyle(numFmt= ""0""),rows=1:nrow(data_memos),cols=which(names(data_memos)==""year""))"
"0","addStyle(wb_wide, ""countries"", createStyle(numFmt= ""0""), cols = 1:ncol(country_summary), rows = 2:(nrow(country_summary) + 1), gridExpand = TRUE)"
"0","addStyle(wb_wide, ""data"", createStyle(textDecoration = ""bold""), rows = which(is.na(data_crts_wide$sector_lv1)) +1,"
"0","         cols=which(names(data_crts_wide)==""sector_description""), gridExpand = TRUE)"
"0",""
"0",""
"0","setColWidths(wb_wide, ""info"", cols = 1, widths = 20)"
"0","setColWidths(wb_wide, ""info"", cols = 2, widths = 200)"
"0","setColWidths(wb_wide, ""data"", cols = 1:ncol(data_crts), widths = ""auto"")"
"0","setColWidths(wb_wide, ""data"", cols=which(names(data_crts)==""iso""), widths = 5)"
"0","setColWidths(wb_wide, ""memos"", cols = 1:ncol(data_memos), widths = ""auto"")"
"0","setColWidths(wb_wide, ""memos"", cols=which(names(data_memos)==""iso""), widths = 5)"
"0","setColWidths(wb_wide, ""countries"", cols = 1:ncol(country_summary), widths = ""auto"")"
"0","setColWidths(wb_wide, ""countries"", cols=which(names(country_summary)==""iso""), widths = 5)"
"0","setColWidths(wb_wide, ""countries"", cols=which(names(country_summary)==""units""), widths = 21)"
"0",""
"0","saveWorkbook(wb_wide,paste0(""data/Tidy-GHG-Inventories-v"",version,""-wide.xlsx""),overwrite=T)"
"0",""
"0",""
